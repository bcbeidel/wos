# WOS Simplification Design

**Date:** 2026-02-22
**Status:** Approved
**Branch:** TBD
**PR:** TBD

## Problem

WOS has accumulated excessive complexity as a starting point: 23 classes, 5
document subclasses with type-specific section requirements, 18 validators,
auto-fix systems, token budget tracking, staleness thresholds, and DDD
protocols. This machinery is hard to maintain and over-prescriptive about
document internals.

## Design Principles

1. **Opinionated about organization, hands-off about content.** WOS cares how
   documents are discoverable (frontmatter, indexes), not what's inside them.
2. **Convention over enforcement.** Document structure patterns are documented,
   not validated.
3. **Flat and simple code.** No inheritance hierarchy, no DDD protocols. ~5
   source files.
4. **Token-conscious.** AGENTS.md section is ~160 tokens. Every word earns its
   place.

## Document Model

One `Document` dataclass. No subclasses.

**Required frontmatter:**

- `name` -- document name
- `description` -- concise summary of file contents

**Optional frontmatter:**

- `type` -- semantic tag (`research`, `plan`, `reference`, etc.). Informational
  only, except: `type: research` triggers source requirements.
- `sources` -- list of URLs. **Required** when `type: research`. Verified at
  creation time and during audit.
- `related` -- list of file paths (project-root-relative) to source/related
  documents. Validated during audit.
- Any additional YAML fields -- passed through, no validation.

**Content:** Opaque markdown. WOS does not enforce sections, ordering, or size.
The "lost-in-the-middle" pattern (summary up top, detail in middle, key
takeaways at bottom) is a documented convention, not enforced.

## Directory Structure

```
project-root/
  context/                  # Agent-facing reference material
    _index.md               # Auto-generated lookup table
    authentication/
      _index.md
      oauth-flows.md
      session-management.md
    deployment/
      _index.md
      ci-cd-pipeline.md
  artifacts/                # Research outputs and plans
    _index.md
    research/
      _index.md
      2026-02-20-oauth-providers.md
    plans/
      _index.md
      2026-02-22-simplification-design.md
  AGENTS.md                 # Navigation instructions (WOS-managed section)
```

## `_index.md` Files

Auto-generated from frontmatter. Never hand-edited.

**Format:**

```markdown
# {Directory Name}

| File | Description |
|------|-------------|
| [oauth-flows.md](oauth-flows.md) | OAuth 2.0 authorization code and PKCE flows |
| [session-management.md](session-management.md) | Server-side session handling |

## Subdirectories

| Directory | Description |
|-----------|-------------|
| [testing/](testing/) | Testing strategies and frameworks |
```

- Description pulled from each file's frontmatter `description` field
- Subdirectory descriptions from their `_index.md`
- Sorted alphabetically
- Regenerated on demand (after `/wos:create`, during audit fix, or via CLI)

## AGENTS.md (WOS-Managed Section)

Everything between `<!-- wos:begin -->` / `<!-- wos:end -->` markers. ~160
tokens. Content outside markers is never touched.

```markdown
<!-- wos:begin -->
## Context Navigation

Each directory has an `_index.md` listing all files with descriptions.
- `context/_index.md` -- all topic areas
- `artifacts/_index.md` -- research & plans

Each `.md` file starts with YAML metadata (between `---` lines).
Read the `description` field before reading the full file.

### Areas
| Area | Path |
|------|------|
| Authentication | context/authentication/ |
| Deployment | context/deployment/ |

### File Metadata Format
```yaml
---
name: Title
description: What this covers
type: research       # optional
sources: []          # required if type is research
related: []          # optional, file paths from project root
---
```

### Preferences
- Direct, concise, code over prose
<!-- wos:end -->
```

**Subsections:**

1. **Navigation instructions** (static) -- how to find and read context files
2. **Areas table** (generated) -- regenerated from disk; lists top-level
   context areas with paths
3. **File metadata format** (static) -- YAML schema example
4. **Preferences** (generated by `/wos:preferences`) -- preserved across
   regenerations

## Validation (5 Checks)

| # | Check | Scope |
|---|-------|-------|
| 1 | Every `.md` (except `_index.md`) has `name` and `description` in frontmatter | Per-file |
| 2 | `type: research` documents have non-empty `sources` list | Per-file |
| 3 | All URLs in `sources` are programmatically reachable (HTTP HEAD/GET) | Per-file |
| 4 | File paths in `related` frontmatter exist on disk | Per-file |
| 5 | Each `_index.md` matches its directory contents | Per-directory |

All checks return pass/fail. If `_index.md` is out of sync, audit offers to
regenerate.

**URL verification runs:**
- At document creation time (via `/wos:create` or `/wos:research`)
- During `/wos:audit`

## Python Package (Clean Slate)

```
wos/
  document.py        # Document dataclass + parse_document()
  index.py           # _index.md generation + sync checking
  validators.py      # 5 validation checks
  url_checker.py     # HTTP HEAD/GET reachability
  agents_md.py       # Marker-based AGENTS.md section management

scripts/
  create.py          # CLI: create context/area/document
  audit.py           # CLI: run validation, offer fixes
  reindex.py         # CLI: regenerate all _index.md files
```

~5 source files in `wos/`, 3 CLI scripts. No inheritance. No DDD protocols.

## Skills (6 Total)

| Skill | User-invocable | Purpose |
|-------|----------------|---------|
| `/wos:create` | No (side effects) | Create project context, areas, or documents |
| `/wos:audit` | Yes (read + opt-in fix) | Validate project health, offer to fix |
| `/wos:research` | Yes | SIFT-based research with source verification |
| `/wos:consider` | Yes | Mental models for problem analysis |
| `/wos:report-issue` | Yes | File GitHub issues against WOS repo |
| `/wos:preferences` | No (side effects) | Capture communication preferences |

**`/wos:create`** handles three intents via natural language routing:
- "Set up context for my project" -- creates `context/`, `artifacts/`,
  AGENTS.md, root `_index.md` files
- "Add a new area for authentication" -- creates `context/authentication/`
  with `_index.md`
- "Create a research doc about X" -- creates file with frontmatter, verifies
  source URLs, updates `_index.md`

## What Gets Deleted

### Code

- `wos/models/` -- entire directory (23 classes, DDD hierarchy)
- `wos/cross_validators.py` -- replaced by checks 4-5 in `validators.py`
- `wos/templates.py` -- no section templates
- `wos/auto_fix.py` -- no auto-fix system
- `wos/token_budget.py` -- no token tracking
- `wos/discovery.py` -- replaced by `_index.md`
- `wos/document_types.py` -- legacy shim
- `wos/scaffold.py` -- folded into `scripts/create.py`

### Skills

- `create-context` -- merged into `/wos:create`
- `create-document` -- merged into `/wos:create`
- `discover` -- replaced by AGENTS.md instructions + `_index.md`
- `fix` -- merged into `/wos:audit`
- `update-context` -- dropped (users move files, reindex)
- `update-document` -- dropped (editing a file is just editing a file)

### Concepts

- Required sections per document type
- Section ordering validation
- Size bounds (min/max lines)
- Staleness tracking (30/60/90 day thresholds)
- Content quality checks (LLM review tier)
- Auto-fix (section reordering/injection)
- Token budget estimation
- Document type dispatch tables
- Frozen value objects / DDD protocols

## What's Preserved

- **Research quality:** SIFT framework, source URL verification (HTTP
  HEAD/GET), reachability checking
- **CLI script interface:** `scripts/` as thin entry points with argparse
- **AGENTS.md marker pattern:** `<!-- wos:begin -->` / `<!-- wos:end -->`
- **Convention-based detection:** `context/` directory = initialized project
- **Mental models:** `/wos:consider` skill unchanged
- **Issue reporting:** `/wos:report-issue` skill unchanged
- **Communication preferences:** `/wos:preferences` skill unchanged
