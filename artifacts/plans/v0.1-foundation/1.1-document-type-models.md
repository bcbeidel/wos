---
document_type: plan
description: "Implement Pydantic v2 document type models, dispatch tables, and parse/validate functions that serve as the shared foundation for all skills"
last_updated: 2026-02-17
status: complete
related:
  - artifacts/research/v0.1-foundation/2026-02-16-document-type-data-models.md
  - artifacts/research/v0.1-foundation/2026-02-16-document-type-specification.md
---

# Implement Document Type Models

## Objective

A Python module exists at `wos/document_types.py` that provides Pydantic v2
models for all four document types (topic, overview, research, plan), dispatch
tables for sections/size/validators/directory patterns, and a `parse_document()`
function that takes a file path and content string and returns a validated
`Document` instance or raises `ValidationError` with clear messages.

Any skill or script can `from wos.document_types import parse_document` and
get type-safe document handling with zero knowledge of type-specific rules.

## Context

- Data model design: `artifacts/research/v0.1-foundation/2026-02-16-document-type-data-models.md`
- Normative spec: `artifacts/research/v0.1-foundation/2026-02-16-document-type-specification.md`
- Requires `pydantic>=2.0` (declared in `pyproject.toml`)
- Python 3.9 runtime — use `from __future__ import annotations` for type hints,
  `Optional[X]` for runtime expressions
- Document type is determined by an explicit `document_type` field in YAML
  frontmatter (not inferred from path)
- Source model is minimal: `url` (required) + `title` (required)
- Description validation: Pydantic `min_length=10` on the field only
- Research documents have optional `status` (plans require it)
- Files without YAML frontmatter raise `ValidationError`
- `related` field accepts both root-relative file paths and URLs
- `tags` field: freeform, lowercase hyphenated (e.g., `["api-design", "caching"]`)
- `DIRECTORY_PATTERNS` should match `_overview.md` (underscore prefix for sort order)
- Validator/trigger dispatch tables (`VALIDATORS_BY_TYPE`, `TIER2_TRIGGERS_BY_TYPE`)
  live in their respective modules (`validators.py`, `tier2_triggers.py`), not here.
  This module only has structural dispatch tables: `SECTIONS`, `SIZE_BOUNDS`,
  `OPTIONAL_SECTIONS`, `DIRECTORY_PATTERNS`

## Steps

1. Set up project tooling: create `pyproject.toml` with pydantic, pytest,
   and ruff as dependencies; add ruff config; create
   `.github/workflows/ci.yml` running pytest + ruff on push

2. Create `wos/__init__.py` and `wos/document_types.py` with the
   `DocumentType` and `PlanStatus` enums, type grouping constants
   (`CONTEXT_TYPES`, `ARTIFACT_TYPES`, `SOURCE_GROUNDED_TYPES`,
   `FRESHNESS_TRACKED_TYPES`)

3. Implement shared models: `Source` (url + title) and `FrontmatterBase`
   (description with `min_length=10`, last_updated with future-date check,
   optional tags as `list[str]` with lowercase-hyphenated validation,
   optional related as `list[str]` accepting root-relative paths or URLs)

4. Implement type-specific frontmatter models: `TopicFrontmatter`,
   `OverviewFrontmatter`, `ResearchFrontmatter`, `PlanFrontmatter` — each with
   a `Literal` document_type field and type-specific required/optional fields.
   Research has optional `status`; Plan has required `status`.

5. Create the discriminated union:
   `Frontmatter = Annotated[Union[...], Field(discriminator="document_type")]`

6. Implement structural dispatch tables (validator/trigger tables live in
   their own modules): `SECTIONS` (with `SectionSpec` model),
   `OPTIONAL_SECTIONS`, `SIZE_BOUNDS` (with `SizeBounds` model),
   `DIRECTORY_PATTERNS` (matching `_overview.md` for overviews)

7. Implement `_split_markdown(content)` — parse YAML frontmatter (raise
   `ValidationError` if no frontmatter found), extract title from first H1,
   extract sections by splitting on H2 headings only (H3+ are content within
   their parent H2), return raw content

8. Implement `Document` model with properties: `document_type`,
   `required_sections`, `size_bounds`

9. Implement `parse_document(path, content)` — split markdown, validate
   frontmatter via discriminated union, return `Document`

10. Create `tests/` directory with `tests/__init__.py` and
   `tests/test_document_types.py`. Write tests using inline markdown strings:
   valid documents for each type pass, missing required fields fail with clear
   messages, wrong directory patterns detected, future dates rejected,
   description-too-short rejected, discriminated union routes correctly,
   no frontmatter raises ValidationError, research parses without
   last_validated, research parses with optional status

## Verification

- `pyproject.toml` declares pydantic, pytest, ruff dependencies
- `ruff check wos/ tests/` passes
- `.github/workflows/ci.yml` runs pytest + ruff
- `python3 -c "from wos.document_types import parse_document, DocumentType"` succeeds
- `python3 -m pytest tests/test_document_types.py -v` — all tests pass
- A topic document with missing `sources` raises `ValidationError` mentioning "sources"
- A plan document with `status: "invalid"` raises `ValidationError` mentioning "status"
- A research document parses successfully without `last_validated` (not required for research)
- A research document parses with or without `status` (optional for research)
- `parse_document()` on a real markdown string returns a `Document` with correct type
- A file with no YAML frontmatter raises `ValidationError`
